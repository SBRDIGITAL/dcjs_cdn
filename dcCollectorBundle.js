var DataCollectorEngine;(()=>{"use strict";var t,e,i,s,n={14:(t,e,i)=>{i.d(e,{LT:()=>s,bO:()=>o});const s={AddProductToCart:"ДОБАВИЛ ТОВАР В КОРЗИНУ",PlaceOrder:"СДЕЛАЛ ЗАКАЗ",SubmitApplication:"ОСТАВИЛ ЗАЯВКУ",OrderService:"ЗАКАЗАЛ УСЛУГУ",RemoveProductFromCart:"УДАЛИЛ ТОВАР ИЗ КОРЗИНЫ",RemoveAllFromCart:"ОЧИСТИЛ КОРЗИНУ",StartCall:"НАЧАЛ ЗВОНОК",SubmitFeedback:"ОСТАВИЛ ОТЗЫВ",UserSuccesAuth:"УСПЕШНО АВТОРИЗОВАЛСЯ"},n="POST";const r=new class{constructor(){this.protocol="https://",this.domen="teorika.ru",this.apiUrl=this.protocol+this.domen,this.dataPath="/user_info/"}},o={init:{endpoint:"init",method:"GET"},entry:{endpoint:"entry",method:n},sourceDomain:{endpoint:"source_domain",method:n},recordAction:{endpoint:"record_action",method:n},addCartInfo:{endpoint:"add_cart_info",method:n},trackTimeSpent:{endpoint:"track_time_spent",method:n},authHandler:{endpoint:"auth_handler",method:n}};!function(t,e){for(let i in e)e.hasOwnProperty(i)&&(e[i].url=`${t.apiUrl}${t.dataPath}${e[i].endpoint}`)}(r,o)},879:(t,e,i)=>{i.d(e,{tj:()=>c,ZK:()=>l});var s=i(14),n=i(592),r=i(335),o=i(998);class a{constructor(){this.toCartBtnClassSelectorWithoutDot="to-cart",this.endpoint="addCartInfo",this.basketSelector="form#basket_form"}async getTotalPrice(t){let e=null;if(t){let i=t.querySelector("div.wrap_total");if(i){let t=i.querySelector("div.price");if(t){let i=t.textContent.trim();e=Number(i.replace(/[^\d]/g,""))}}}return e}async trackingCartItems(){let t=document.querySelector(this.basketSelector);if(t){let e=[],i=null;const s=async()=>{let s=t.querySelectorAll("div.product_name");if(i=await this.getTotalPrice(t),e=[],s.length>0)for(let t of s){let i=t.querySelector("a");i&&e.push(i.textContent.trim())}},n={childList:!0,subtree:!0};return new MutationObserver((async t=>{for(let e of t)"childList"!==e.type&&"subtree"!==e.type||await s()})).observe(t,n),await s(),{productNames:e,totalPrice:i}}return null}async#t(t,e){const i=n.I.getEndpoingInfo(this.endpoint),s={item_names:t,amount:e};await r.N.sendRequest(i,s)}async checkAddToCartBtn(t){if(o.cU.ifElementContainsClass(t,this.toCartBtnClassSelectorWithoutDot)){let t=[],e=null;for(let i=0;i<3;i++){await(0,o.cb)(500);let i=await this.trackingCartItems();i&&(t=i.productNames,e=i.totalPrice),await(0,o.cb)(1500)}t.length>0&&e&&await this.#t(t,e)}}async startTrack(t){await this.checkAddToCartBtn(t)}}class c{static async recordAction(t,e="recordAction"){const i=window.location.href,s=n.I.getEndpoingInfo(e),o={event_url:{url:i},event:{event_name:t}};await r.N.sendRequest(s,o)}static async dcAttributesSet(t,e="data-collector-inited",i="true"){t.setAttribute(e,i)}}const l=new class{constructor(){this.currentDocument=document.body,this.dcInitedAttr="data-collector-inited",this.setIntervalPauseMs=100,this.cartInfoTracker=new a,this.toCartBtnClassSelectorWithoutDot=this.cartInfoTracker.toCartBtnClassSelectorWithoutDot,this.endpoint="recordAction",this.cartButtons=null,this.removeButtons=null,this.createOrderBtn=document.querySelector("div#bx-soa-orderSave"),this.callbackButton=document.evaluate("//span[text()='Заказать звонок']",document,null,XPathResult.FIRST_ORDERED_NODE_TYPE,null).singleNodeValue}async recordAction(t,e){await c.recordAction(t,e)}async initButtonTracking(t,e,i,s){t&&t.addEventListener("click",(async i=>{await o.cU.ifElementContainsClass(t,this.toCartBtnClassSelectorWithoutDot)?(await this.cartInfoTracker.startTrack(t),await this.recordAction(e)):await this.recordAction(e).then((()=>{})).catch((t=>{}))}))}async initPlaceOrderButtonInBasketPage(){if(!window.location.href.includes("/basket/"))return;const t=setInterval((async()=>{let e=document.querySelector('div[data-entity="basket-total-block"]');if(e){const i=async()=>{const t=e.querySelector('button[data-entity="basket-checkout-button"]');t&&(t.hasAttribute(this.dcInitedAttr)||(await this.initButtonTracking(t,s.LT.PlaceOrder,"Заказ успешно оформлен.","Ошибка при оформлении заказа:"),await c.dcAttributesSet(t,this.dcInitedAttr)))},n={childList:!0,subtree:!0};new MutationObserver((async t=>{for(let e of t)"childList"!==e.type&&"subtree"!==e.type||await i()})).observe(e,n),await i(),clearInterval(t)}}),this.setIntervalPauseMs)}async initFastOrderButtonInBasketPage(){if(!window.location.href.includes("/basket/"))return;const t=setInterval((async()=>{let e=document.querySelector('div[data-entity="basket-total-block"]');if(e){const i=async()=>{const t=e.querySelector('span[onclick="oneClickBuyBasket()"]');t&&(t.hasAttribute(this.dcInitedAttr)||(await this.initButtonTracking(t,s.LT.PlaceOrder,"Заказ успешно оформлен.","Ошибка при оформлении заказа:"),await c.dcAttributesSet(t,this.dcInitedAttr)))},n={childList:!0,subtree:!0};new MutationObserver((async t=>{for(let e of t)"childList"!==e.type&&"subtree"!==e.type||await i()})).observe(e,n),await i(),clearInterval(t)}}),this.setIntervalPauseMs)}async initRemoveButtons(){let t=document.querySelector("div#basket-items-list-wrapper");if(t){const e=async()=>{if(this.removeButtons=t.querySelectorAll('span[data-entity="basket-item-delete"]'),this.removeButtons)for(let t of this.removeButtons)t.hasAttribute(this.dcInitedAttr)||(await this.initButtonTracking(t,s.LT.RemoveProductFromCart,"Товар удален из корзины.","Ошибка при удалении товара из корзины:"),await c.dcAttributesSet(t,this.dcInitedAttr))},i={childList:!0,subtree:!0};new MutationObserver((async t=>{for(let i of t)"childList"!==i.type&&"subtree"!==i.type||await e()})).observe(t,i),await e()}}async initCartButtons(){const t=setInterval((async()=>{if(this.cartButtons=document.querySelectorAll(`.${this.toCartBtnClassSelectorWithoutDot}`),this.cartButtons.length>0){for(const t of this.cartButtons){const e=`Товар с ID ${t.getAttribute("data-item")} добавлен в корзину.`;t.hasAttribute(this.dcInitedAttr)||(await this.initButtonTracking(t,s.LT.AddProductToCart,e,"Ошибка при добавлении товара в корзину:"),await c.dcAttributesSet(t,this.dcInitedAttr))}clearInterval(t)}}),this.setIntervalPauseMs+100)}async initOneClickBuy(){if(this.currentDocument){const t=async()=>{const t=document.querySelectorAll("div.wrapp-one-click");if(t.length>0)for(let e of t)try{e.hasAttribute(this.dcInitedAttr)||(await this.initButtonTracking(e,s.LT.PlaceOrder,"Выполнен заказ в 1 клик","Ошибка при выполнении заказа в 1 клик"),await c.dcAttributesSet(e,this.dcInitedAttr))}catch(t){}},e={childList:!0,subtree:!0};new MutationObserver((async e=>{for(let i of e)"childList"!==i.type&&"subtree"!==i.type||await t()})).observe(this.currentDocument,e),await t()}}async addSubmitButtonListener(){if(this.currentDocument){const t=async()=>{const t=document.querySelector('form[name="CALLBACK_RkUzu"]');if(t){const e=t.querySelector('button[type="submit"]')||t.querySelector('button[type="button"]');if(e&&!e.hasAttribute(this.dcInitedAttr))try{await this.initButtonTracking(e,s.LT.SubmitApplication,"Оставлена заявка","Ошибка при оставлении заявки"),await c.dcAttributesSet(e,this.dcInitedAttr)}catch(t){}}},e={childList:!0,subtree:!0};new MutationObserver((async e=>{for(let i of e)"childList"!==i.type&&"subtree"!==i.type||await t()})).observe(this.currentDocument,e),await t()}}async addSubmitButtonListeners(){const t=/SERVICES_/;if(this.currentDocument){const e=async()=>{const e=document.querySelectorAll("form");if(e.length>0){const i=[];if(e.forEach((e=>{t.test(e.name)&&i.push(e)})),i.length>0)for(let t of i){let e=t.querySelector('button[type="submit"]');if(e)try{e.hasAttribute(this.dcInitedAttr)||(await this.initButtonTracking(e,s.LT.OrderService,"Заказал услугу","Ошибка при заказе услуги"),await c.dcAttributesSet(e,this.dcInitedAttr))}catch(t){}}}},i={childList:!0,subtree:!0};new MutationObserver((async t=>{for(let i of t)"childList"!==i.type&&"subtree"!==i.type||await e()})).observe(this.currentDocument,i),await e()}}async initDeleteAllFromBasketBtn(){const t=document.querySelector("div#basket-root");if(t){const e=t.querySelector("span.delete_all");if(e)try{await this.initButtonTracking(e,s.LT.RemoveAllFromCart,"Корзина очищена","Ошибка при очистке корзины")}catch(t){}}}async initCallButtonTracking(){if(document.querySelector("div.phone-block")){const t=document.querySelector('a[rel="nofollow"]');t&&await this.initButtonTracking(t,s.LT.StartCall,"Начало звонка зафиксировано.","Ошибка при фиксации начала звонка.")}}async initFeedbackButtonTracking(){if(this.currentDocument){const t=async()=>{let t=this.currentDocument.querySelector('[data-param-form_id="FEEDBACK_GK"]')||null;t&&(t.hasAttribute(this.dcInitedAttr)||(await this.initButtonTracking(t,s.LT.SubmitFeedback,"Отзыв успешно оставлен.","Ошибка при оставлении отзыва:"),await c.dcAttributesSet(t,this.dcInitedAttr)))},e={childList:!0,subtree:!0};new MutationObserver((async e=>{for(let i of e)"childList"!==i.type&&"subtree"!==i.type||await t()})).observe(this.currentDocument,e),await t()}}async initActionTrackers(){await this.addSubmitButtonListeners(),await this.initCartButtons(),await this.initDeleteAllFromBasketBtn(),await this.initRemoveButtons(),await this.initFastOrderButtonInBasketPage(),await this.initPlaceOrderButtonInBasketPage(),await this.initOneClickBuy(),await this.addSubmitButtonListener(),await this.initCallButtonTracking(),await this.initFeedbackButtonTracking()}}},819:(t,e,i)=>{i.d(e,{d:()=>l});var s=i(18),n=i(660),r=i(879),o=i(14),a=i(592),c=i(335);const l=new class{constructor(){this.LSAuthInfoKey="bx-compositeCache",this.userIdKey="USER_ID",this.dcSendedKey="DC_AUTH_INFO_SENDED",this.isUserAuthDcInfoValue=!0,this.checkInterval=5e3,this.endpoint="authHandler"}async setDcInfoSendedCookie(t=!1){const e=t?"true":"false";n.s.setCookie(this.dcSendedKey,e,720)}async getLsInfo(){let t=null;const e=s.S.getItem(this.LSAuthInfoKey)||null,i=n.s.getCookie(this.dcSendedKey)||"false";if(e&&"string"==typeof e){const i=e.indexOf(":");if(-1!==i){const s=e.substring(i+1);try{t=JSON.parse(s)}catch(t){}}}return{result:t,sendedInfo:i}}async checkUserId(){let{result:t,sendedInfo:e}=await this.getLsInfo();if(t){let i=t[this.userIdKey]||"";return""!==i?{uID:i,sended:"true"===e}:null}return null}async#e(t){try{await r.tj.recordAction(o.LT.UserSuccesAuth);const e=a.I.getEndpoingInfo(this.endpoint),i={cms_user_id:Number(t)};await c.N.sendRequest(e,i)}catch(t){}}async sendInfo(){const t=setInterval((async()=>{let e=await this.checkUserId();if(e&&"object"==typeof e){let{uID:i,sended:s}=e;!0===s?clearInterval(t):!1===s&&(await this.#e(i),await this.setDcInfoSendedCookie(this.isUserAuthDcInfoValue))}}),this.checkInterval)}async start(){await this.sendInfo()}}},992:(t,e,i)=>{i.d(e,{c:()=>r});var s=i(592),n=i(335);async function r(t="init",e=2){let i=s.I.getEndpoingInfo(t);const r={};for(let t=0;t<e;t++)await n.N.sendRequest(i,r),t<e-1&&await new Promise((t=>setTimeout(t,5e3)))}},28:(t,e,i)=>{i.d(e,{H:()=>a});var s=i(18),n=i(335),r=i(592),o=i(660);class a{constructor(){this.visitTrackerCookieKey="visitTracker",this.visitTrackerCookieValue="working",this.visitTrackerCookieExpiration=5,this.visitsKey="pageVisits",this.checkInterval=5e3,this.endpoint="trackTimeSpent",this.visits=this.loadVisitsFromLocalStorage(),this.currentVisit=null}loadVisitsFromLocalStorage(){const t=s.S.getItem(this.visitsKey);return t?JSON.parse(t):[]}saveVisitsToLocalStorage(){s.S.setItem(this.visitsKey,JSON.stringify(this.visits))}startVisit(t){this.currentVisit&&this.endVisit(),this.currentVisit={url:t,startTime:performance.now()}}endVisit(){if(this.currentVisit){const t=Math.round((performance.now()-this.currentVisit.startTime)/1e3),e=(new Date).toISOString(),i=this.visits.findIndex((t=>t.url===this.currentVisit.url));-1!==i?this.visits[i].duration+=t:this.visits.push({url:this.currentVisit.url,visit_time:e,duration:t}),this.saveVisitsToLocalStorage(),this.currentVisit=null}}async sendVisits(){if(0===this.visits.length)return;const t=r.I.getEndpoingInfo(this.endpoint),e={visits_info:this.visits};try{await n.N.sendRequest(t,e),this.#i()}catch(t){}}startTracking(){this.startVisit(window.location.href),setInterval((()=>{this.endVisit(),this.startVisit(window.location.href),this.sendVisits()}),this.checkInterval),window.onpopstate=()=>{this.startVisit(window.location.href)};const t=history.pushState;history.pushState=(...e)=>{t.apply(history,e),this.startVisit(window.location.href)};const e=history.replaceState;history.replaceState=(...t)=>{e.apply(history,t),this.startVisit(window.location.href)},window.addEventListener("beforeunload",(()=>{this.endVisit()}))}#i(){o.s.setCookie(this.visitTrackerCookieKey,this.visitTrackerCookieValue,this.visitTrackerCookieExpiration)}checkSessionAndStartTracking(){try{o.s.getCookie(this.visitTrackerCookieKey)?this.startTracking():(s.S.removeItem(this.visitsKey),this.#i())}catch(t){}}}},622:(t,e,i)=>{i.d(e,{o:()=>o});var s=i(660),n=i(592),r=i(335);const o=new class{constructor(){this.modes=["entry","sourceDomain"],this.entryUrlEndpoint=this.modes[0],this.sourceDomainEndpoint=this.modes[1],this.entryUrlCookieName="entryUrl",this.sourceDomainCookieName=this.sourceDomainEndpoint,this.expirationMinutes=5,this.currentUrl=null,this.endpoint=null,this.cookieName=null}#s(t,e){s.s.setCookie(t,e,this.expirationMinutes)}async#n(){let t=n.I.getEndpoingInfo(this.endpoint);const e={url:this.currentUrl};await r.N.sendRequest(t,e)&&this.#s(this.cookieName,e.url)}async#r(t){t===this.entryUrlEndpoint?(this.currentUrl=window.location.href,this.endpoint=t,this.cookieName=this.entryUrlCookieName):t===this.sourceDomainEndpoint&&(this.currentUrl=document.referrer||null,this.endpoint=t,this.cookieName=this.sourceDomainCookieName);const e=s.s.getCookie(this.cookieName);e?this.#s(this.cookieName,e):await this.#n()}async trackInfo(){for(let t of this.modes)await this.#r(t)}}},660:(t,e,i)=>{i.d(e,{s:()=>n});var s=i(998);class n{constructor(){}static setCookie(t,e,i){const n="expires="+s.cU.getExpiresTime(i);document.cookie=`${t}=${e}; ${n}; path=/`}static getCookie(t){const e=`; ${document.cookie}`.split(`; ${t}=`);return 2===e.length?e.pop().split(";").shift():null}}},592:(t,e,i)=>{i.d(e,{I:()=>r});var s=i(14);class n{constructor(){this.endpoints=s.bO}getEndpointConfig(t){return this.endpoints[t]||null}}const r=new class{constructor(){this.endpointsConfig=new n}getEndpoingInfo(t){return this.endpointsConfig.getEndpointConfig(t)}}},998:(t,e,i)=>{i.d(e,{cU:()=>s,cb:()=>n});class s{static getExpiresTime(t){const e=new Date;return e.setTime(e.getTime()+60*t*1e3),e.toUTCString()}static async getNewObject(t){return JSON.parse(JSON.stringify(t))}static async logToConsole(t){const e=await s.getNewObject(t);console.log(e)}static async ifElementContainsClass(t,e){if("string"==typeof e)return t.classList.contains(e);if(Array.isArray(e))for(const i of e)if(t.classList.contains(i))return!0;return!1}}const n=t=>new Promise((e=>setTimeout(e,t)))},18:(t,e,i)=>{i.d(e,{S:()=>s});class s{static setItem(t,e){"object"==typeof e&&null!==e?e=JSON.stringify(e):"string"!=typeof e&&(e=String(e)),localStorage.setItem(t,e)}static getItem(t){const e=localStorage.getItem(t);return null!==e?e:null}static removeItem(t){localStorage.removeItem(t)}static clear(){localStorage.clear()}}},335:(t,e,i)=>{i.d(e,{N:()=>s});class s{constructor(){}static async sendRequest(t,e={}){const{url:i,method:s,endpoint:n}=t,r={method:s,mode:"cors",credentials:"include",headers:{"Content-Type":"application/json"},body:"POST"===s?JSON.stringify(e):void 0};try{const t=await fetch(i,r);if(!t.ok)throw new Error("Сетевая ошибка: "+t.statusText);return await t.json()}catch(t){}}}},994:(t,e,i)=>{i.a(t,(async(t,s)=>{try{i.r(e);var n=i(992),r=i(622),o=i(879),a=i(819),c=i(28);class t{static pageVisitTracker=new c.H;static async#o(t,...e){try{await t(...e)}catch(e){console.error(`Ошибка при выполнении метода ${t.name}:`,e)}}static#a(e=10,...i){setInterval((()=>{try{t.#o(n.c,...i)}catch(t){console.error("Ошибка при вызове метода initUser:",t)}}),1e3*e)}static async start(){await t.#o(n.c,"init",2),this.#a(10,"init",2),await t.#o(r.o.trackInfo.bind(r.o)),await t.#o(a.d.start.bind(a.d)),await t.#o(this.pageVisitTracker.checkSessionAndStartTracking.bind(this.pageVisitTracker)),await t.#o(o.ZK.initActionTrackers.bind(o.ZK))}}await t.start(),s()}catch(t){s(t)}}),1)}},r={};function o(t){var e=r[t];if(void 0!==e)return e.exports;var i=r[t]={exports:{}};return n[t](i,i.exports,o),i.exports}t="function"==typeof Symbol?Symbol("webpack queues"):"__webpack_queues__",e="function"==typeof Symbol?Symbol("webpack exports"):"__webpack_exports__",i="function"==typeof Symbol?Symbol("webpack error"):"__webpack_error__",s=t=>{t&&t.d<1&&(t.d=1,t.forEach((t=>t.r--)),t.forEach((t=>t.r--?t.r++:t())))},o.a=(n,r,o)=>{var a;o&&((a=[]).d=-1);var c,l,u,d=new Set,h=n.exports,y=new Promise(((t,e)=>{u=e,l=t}));y[e]=h,y[t]=t=>(a&&t(a),d.forEach(t),y.catch((t=>{}))),n.exports=y,r((n=>{var r;c=(n=>n.map((n=>{if(null!==n&&"object"==typeof n){if(n[t])return n;if(n.then){var r=[];r.d=0,n.then((t=>{o[e]=t,s(r)}),(t=>{o[i]=t,s(r)}));var o={};return o[t]=t=>t(r),o}}var a={};return a[t]=t=>{},a[e]=n,a})))(n);var o=()=>c.map((t=>{if(t[i])throw t[i];return t[e]})),l=new Promise((e=>{(r=()=>e(o)).r=0;var i=t=>t!==a&&!d.has(t)&&(d.add(t),t&&!t.d&&(r.r++,t.push(r)));c.map((e=>e[t](i)))}));return r.r?l:o()}),(t=>(t?u(y[i]=t):l(h),s(a)))),a&&a.d<0&&(a.d=0)},o.d=(t,e)=>{for(var i in e)o.o(e,i)&&!o.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:e[i]})},o.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),o.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})};var a=o(994);DataCollectorEngine=a})();
